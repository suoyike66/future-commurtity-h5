import{G as ae,g as te,P as ne,B as le,m as oe}from"./base-util-LDrhyDoM.js";import{r as ue}from"./resident-CqofEgMf.js";import{u as se,i as ie}from"./user-DclUuafn.js";import{d as re,r as o,l as de,q as me,c as O,o as p,a as l,b as u,e as s,F as pe,h as ve,f as A,u as w,p as Ae,m as ce,j as fe,_ as ge}from"./index-Dh5izbV7.js";const Ce="/systemDictionary",h={getListByRootCode:V=>new ae(`${Ce}/listDictionaryByRootCode/${V}`,{}).request()},ke="/logFile",ye={upload:V=>{const t=te();return t.hasFile=!0,new ne(`${ke}/upload`,V,t).request()}},Ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAMAAADypuvZAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAABRUExURUxpcfzXh/zWh/vWh/zWh/zWh/zWh/rXh/7Xh/zWh//ehP3WiPzWh/3Xh/3ViPzXhvzWh//////9+fzakf7z3P7rw/3enP/57P7vzv3ls/3hpR/tSLQAAAAQdFJOUwCU943g70kzJ8cHz75mZ2XWtmHCAAABqElEQVRIx62W25aDIAxFQfFWdRpUFP3/Dx1A7JSQqmXNeaiX5QZymkAYi1U/eScKgEJ0/FmzG6pzAYFEXl0gZQOEmvIEqUjEYZ9me+RwIv4gg2nhVC1hSVXAhYpoiWUGl8qQH9UNxlDBXHUBt1S8xfVo4abaPw853BZ/BQRf6AiLzAM9TKO5jCPODe82gYyLlHKYQdmfUOWnibZBWg2blnKjpiIi2gwwgQHkEkMuqjhNV/O1AuWuBJQbSOCXyjGTXHYKxwTCJENkmxvdGQGzWydWzX7Qm8kOPu5GyM3eLNj1HmWDtXoYZ3nITYld56zDVvtQvJSbeg2gLvBhdSEo+S7tntfQifeicN9oGWofJSgrFqxOrW41ocx6Vbg+hpPu+FIrtfh7/E9lDNWsN3txDwsNFTghPDS9coOARGg5gjQNdbjU70Acp9EdqMcJ6yF9FlONS8NbPkxWtHsiKsJRxprjIkTlrgYsTW1iDXyl5uMWdqLyZLM8nyhxW046ANKOmqRDLe34TDuoDXXdEpT/03yktTlpDVVi65bYJO5cb9vRLLPtaE+F/wuDkYcYEMFppgAAAABJRU5ErkJggg==",we="data:image/png;base64,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",Ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAZCAMAAAD3wqVsAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAABLUExURUxpcQCP/wCP/wCQ/wCP/wCO/wCP/wCP/wCQ/wCP/wCP/wCP/wCP/wCT/wCP/wCP/wCP/wCP/wCP/wCP/wCR/wCP/wCP/wCQ/wCP/xchNjYAAAAYdFJOUwAylkYnO+byhnH8ZMoPoIu/qVF7H9a1GAikRhsAAADLSURBVCjPrZDJFoMgDEWfQoMDOOCU///SBrEVPHTXu0jQG2MCcFPN264k90S0rUjxHOiBIWSVqoaNd4q4Rh/cK1E105ktj2PunOUZbjJWSxFnThtpJeF8t2ROhRFUrJeTT1wbTi1/aKCJWZ9qZFplypsh/l6YeAJ2TrHAzJsDSZn4nO2Qbh3mBgfxk65Cu0vT1XCBOOdSUrLvtUKB8eHsMCVbZs7HKyq5Gmrw30vInYYEh6JbcY7e/fyu+o9bcpfdS28iGhIqXE8L8AZQliV8BcPKTQAAAABJRU5ErkJggg==",qe={class:"page"},Pe=6e4,Re=re({__name:"Add",setup(V){const t=o({concatName:"",concatPhone:"",content:"",fkPublishUserId:"",fkRepairMasterId:"",fkRoomId:"",imgList:[],imgListString:"",place:"",questionTypeId:"",questionTypeName:"",repairDate:"",status:1,typeId:"",typeName:""}),f=o(""),i=o(!1),g=o(""),C=se(),R=o({}),k=o(""),q=o("");de(async()=>{await j(),await X(),M(),t.value.fkPublishUserId=C.user?.id||C.userInfo?.fkUserId||"",t.value.concatName=R.value.name||C.user?.userName||C.userInfo?.userInfoName||"",t.value.concatPhone=R.value.mobile||C.userInfo?.phone||""});const r=o([]);me(r,()=>{const a=r.value.filter(e=>e.status==="done");t.value.imgListString=a.map(e=>e.id).join(",")},{immediate:!0,deep:!0});const L=fe();async function T(){console.log("提交报修单",t.value),await requestRepair.add({...t.value,repairDate:t.value.repairDate?t.value.repairDate+" 00:00:00":void 0}),oe.success("报修单提交成功"),L.back()}const x=o([new Date().getFullYear().toString(),(new Date().getMonth()+1).toString(),new Date().getDate().toString()]),J=new Date;function S(a){console.log("选择的维修日期",a),q.value=a.selectedValues.join("-"),t.value.repairDate=q.value,i.value=!1}const B=o([]);async function M(){const{data:a}=await h.getListByRootCode("online_repair_question_type");B.value=a||[]}function N(a){t.value.questionTypeId=a.selectedOptions[0].id,t.value.questionTypeName=a.selectedOptions[0].itemName,i.value=!1,F()}const Q=o([]);async function F(){const{data:a}=await requestMaster.all({handlerType:1,questionTypeId:t.value.questionTypeId});a&&a.length>0?(Q.value=a||[],t.value.fkRepairMasterId=a[0].id,k.value=a[0].name):(t.value.fkRepairMasterId="",k.value="")}function W(a){t.value.fkRepairMasterId=a.selectedOptions[0].userId,k.value=a.selectedOptions[0].name,i.value=!1}async function I(a,e){if(console.log("选择的图片",a,e),a instanceof Array)for(let v of a)await I(v,{name:v.file?.name,index:e.index++});else{r.value[e.index]={id:"-1",url:a.url,status:"uploading",message:"上传中..."},console.log("上传图片",r.value),setTimeout(()=>{r.value.filter(d=>d.status==="uploading").forEach(d=>{d.status="failed",d.message="上传失败"})},Pe);const{data:v,code:b,message:D}=await ye.upload({file:a.file});b==="0"?r.value[e.index]={id:v.id,url:le.getUploadPath(v.uploadPath||""),status:"done"}:(r.value[e.index].status="failed",r.value[e.index].message=D||"上传失败")}}function Y(a,e){r.value.splice(e.index,1)}function P(a){g.value=a,i.value=!0}function Z(a){t.value.fkRoomId=a.selectedOptions[0].value,t.value.place=a.selectedOptions[0].text,f.value=a.selectedOptions[0].text,i.value=!1}const y=o([]);async function X(){const{data:a}=await ue.my();console.log("住户信息",a),R.value=a||{},a&&a?.roomList&&a?.roomList?.length>0&&(y.value=a.roomList.map(e=>({text:`${e.community?.name}${e.unit?.name}${e.building?.name}${e.name}`,value:e.id})))}const U=o([]),c=o("1");async function j(){const{data:a}=await h.getListByRootCode("online_repair_type");a&&(U.value=a),t.value.typeName=U.value[0]?.itemName||"",t.value.typeId=U.value[0]?.id||"",c.value=U.value[0]?.itemValue||"1"}function z(a){t.value.typeName=a?.itemName||"",t.value.typeId=a?.id||"",c.value=a?.itemValue||"1",c.value==="1"?(f.value=y.value[0].text||"",t.value.fkRoomId=y.value[0].value||"",t.value.place=y.value[0].text||""):(f.value="",t.value.fkRoomId="",t.value.place="")}return(a,e)=>{const v=s("van-image"),b=s("van-radio"),D=s("van-cell"),d=s("van-cell-group"),H=s("van-radio-group"),m=s("van-field"),G=s("van-uploader"),K=s("van-button"),_=s("van-form"),E=s("van-picker"),$=s("van-date-picker"),ee=s("van-popup");return p(),O("div",qe,[l(_,{onSubmit:T},{default:u(()=>[l(d,{inset:""},{default:u(()=>[l(H,{modelValue:t.value.typeName,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.typeName=n)},{default:u(()=>[l(d,{inset:""},{default:u(()=>[(p(!0),O(pe,null,ve(U.value,n=>(p(),A(D,{key:n.id,title:n.itemName,clickable:"",onClick:be=>z(n)},{icon:u(()=>[l(v,{src:n.itemValue==="1"?w(Ue):w(we)},null,8,["src"])]),"right-icon":u(()=>[l(b,{name:n.itemName},null,8,["name"])]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{inset:""},{default:u(()=>[c.value==="2"?(p(),A(m,{key:0,modelValue:t.value.place,"onUpdate:modelValue":e[1]||(e[1]=n=>t.value.place=n),placeholder:"请输入维修地点",label:"维修地点",maxlength:"50","input-align":"right",required:c.value==="2",rules:[{required:!0,message:"请输入维修地点"}]},null,8,["modelValue","required"])):(p(),A(m,{key:1,modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=n=>f.value=n),"left-icon":w(Ve),"is-link":"",readonly:"",border:!1,required:c.value==="1",rules:[{required:!0,message:"请选择房间"}],onClick:e[3]||(e[3]=n=>P("room"))},null,8,["modelValue","left-icon","required"]))]),_:1}),l(d,{inset:""},{default:u(()=>[l(m,{modelValue:t.value.content,"onUpdate:modelValue":e[4]||(e[4]=n=>t.value.content=n),rows:"1",autosize:"",type:"textarea",placeholder:"请简单描述现场情况（如：浴室下水道堵塞），以便开展维修。"},null,8,["modelValue"]),l(m,null,{input:u(()=>[l(G,{modelValue:r.value,"onUpdate:modelValue":e[5]||(e[5]=n=>r.value=n),"max-count":"9",multiple:"",accept:"image/*","result-type":"file","after-read":I,"before-delete":Y},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{inset:""},{default:u(()=>[l(m,{modelValue:t.value.questionTypeName,"onUpdate:modelValue":e[6]||(e[6]=n=>t.value.questionTypeName=n),label:"问题类型",placeholder:"请选择问题类型","is-link":"",readonly:"","input-align":"right",required:!0,rules:[{required:!0,message:"请选择问题类型"}],onClick:e[7]||(e[7]=n=>P("questionType"))},null,8,["modelValue"]),l(m,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=n=>k.value=n),label:"联系专员",placeholder:"请选择联系专员","is-link":"",readonly:"","input-align":"right",required:!0,rules:[{required:!0,message:"请选择联系专员"}],onClick:e[9]||(e[9]=n=>P("master"))},null,8,["modelValue"]),l(m,{modelValue:q.value,"onUpdate:modelValue":e[10]||(e[10]=n=>q.value=n),label:"维修日期",placeholder:"请选择维修日期","is-link":"",readonly:"","input-align":"right",required:!0,rules:[{required:!0,message:"请选择维修日期"}],onClick:e[11]||(e[11]=n=>P("repairDate"))},null,8,["modelValue"])]),_:1}),l(d,{inset:""},{default:u(()=>[l(m,{modelValue:t.value.concatName,"onUpdate:modelValue":e[12]||(e[12]=n=>t.value.concatName=n),label:"联系人",placeholder:"请输入联系人","input-align":"right",required:!0,rules:[{required:!0,message:"请输入联系人"}]},null,8,["modelValue"]),l(m,{modelValue:t.value.concatPhone,"onUpdate:modelValue":e[13]||(e[13]=n=>t.value.concatPhone=n),label:"联系电话",placeholder:"请输入联系电话","input-align":"right",required:!0,rules:[{required:!0,message:"请输入联系电话"},{validator:n=>w(ie)(n+""),message:"请输入正确的手机号"}]},null,8,["modelValue","rules"])]),_:1}),l(K,{type:"primary",round:"",block:"","native-type":"submit"},{default:u(()=>[...e[20]||(e[20]=[Ae("立即上报",-1)])]),_:1})]),_:1}),l(ee,{show:i.value,"onUpdate:show":e[19]||(e[19]=n=>i.value=n),position:"bottom"},{default:u(()=>[g.value==="room"?(p(),A(E,{key:0,columns:y.value,onConfirm:Z,onCancel:e[14]||(e[14]=n=>i.value=!1)},null,8,["columns"])):g.value==="questionType"?(p(),A(E,{key:1,columns:B.value,"columns-field-names":{text:"itemName",value:"id"},onConfirm:N,onCancel:e[15]||(e[15]=n=>i.value=!1)},null,8,["columns"])):g.value==="master"?(p(),A(E,{key:2,columns:Q.value,"columns-field-names":{text:"name",value:"userId"},onConfirm:W,onCancel:e[16]||(e[16]=n=>i.value=!1)},null,8,["columns"])):g.value==="repairDate"?(p(),A($,{key:3,modelValue:x.value,"onUpdate:modelValue":e[17]||(e[17]=n=>x.value=n),title:"选择维修日期","min-date":w(J),onConfirm:S,onCancel:e[18]||(e[18]=n=>i.value=!1)},null,8,["modelValue","min-date"])):ce("",!0)]),_:1},8,["show"])])}}}),Qe=ge(Re,[["__scopeId","data-v-a2a6fdcb"]]);export{Qe as default};
